<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SlitherCookie</title>
    <style>
        body { margin: 0; background: #f5e6c8; }
        canvas { display: block; margin: 0 auto; background: #fffbe6; border: 2px solid #b8860b; }
        #score, #bestScore { text-align: center; font-family: sans-serif; font-size: 24px; margin: 10px; color: #8b5c2a; }
        #mainMenu, #nameMenu {
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(245,230,200,0.97); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10;
        }
        #mainMenu h1, #nameMenu h2 { color: #8b5c2a; font-family: sans-serif; }
        #mainMenu button, #nameMenu button {
            font-size: 22px; padding: 10px 30px; margin: 15px; border-radius: 8px;
            border: 2px solid #b8860b; background: #fffbe6; color: #8b5c2a; cursor: pointer;
        }
        #nameInput { font-size: 20px; padding: 8px; border-radius: 6px; border: 1px solid #b8860b; }
        #backBtn {
            position: absolute; top: 20px; left: 20px; font-size: 18px; padding: 6px 18px;
            border-radius: 6px; border: 2px solid #b8860b; background: #fffbe6; color: #8b5c2a; cursor: pointer;
            z-index: 5;
        }
    </style>
</head>
<body>
    <div id="score" style="display:none;">Score: 0</div>
    <div id="bestScore" style="display:none;">Your best score is: 0</div>
    <button id="backBtn" style="display:none;">Back to Main Menu</button>
    <canvas id="game" width="800" height="600" style="display:none;"></canvas>

    <!-- Main Menu -->
    <div id="mainMenu">
        <h1>SlitherCookie</h1>
        <button id="startBtn">Start Game</button>
        <button id="goBackBtn">Go Back to Cookie clicker</button>
    </div>
    <!-- Name Selection Menu -->
    <div id="nameMenu" style="display:none;">
        <h2>Enter Your Name</h2>
        <input id="nameInput" maxlength="16" placeholder="Your name..." />
        <button id="playBtn">Play!</button>
    </div>

    <script>
        // Menu elements
        const mainMenu = document.getElementById('mainMenu');
        const nameMenu = document.getElementById('nameMenu');
        const startBtn = document.getElementById('startBtn');
        const goBackBtn = document.getElementById('goBackBtn');
        const playBtn = document.getElementById('playBtn');
        const nameInput = document.getElementById('nameInput');
        const backBtn = document.getElementById('backBtn');
        const scoreDiv = document.getElementById('score');
        const bestScoreDiv = document.getElementById('bestScore');
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');

        let playerName = "Player";

        // Best score logic
        let bestScore = Number(localStorage.getItem('slithercookie_best')) || 0;
        bestScoreDiv.textContent = "Your best score is: " + bestScore;

        // Menu logic
        startBtn.onclick = () => {
            mainMenu.style.display = 'none';
            nameMenu.style.display = 'flex';
            nameInput.value = '';
            nameInput.focus();
        };
        goBackBtn.onclick = () => {
            window.location.href = "index.html";
        };
        playBtn.onclick = () => {
            playerName = nameInput.value.trim() || "Player";
            nameMenu.style.display = 'none';
            startGame();
        };
        nameInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') playBtn.click();
        });
        backBtn.onclick = () => {
            stopGame();
            mainMenu.style.display = 'flex';
        };

        // Game variables
        const gridSize = 25;
        const gridWidth = Math.floor(canvas.width / gridSize);
        const gridHeight = Math.floor(canvas.height / gridSize);

        let snake, direction, nextDirection, score, food, running = false, intervalId;

        function startGame() {
            // Show game UI
            scoreDiv.style.display = '';
            bestScoreDiv.style.display = '';
            canvas.style.display = '';
            backBtn.style.display = '';
            // Reset game state
            snake = [
                {x: Math.floor(gridWidth/2), y: Math.floor(gridHeight/2)}
            ];
            direction = {x: 1, y: 0}; // Start moving right
            nextDirection = {x: 1, y: 0};
            score = 0;
            scoreDiv.textContent = "Score: 0";
            bestScoreDiv.textContent = "Your best score is: " + bestScore;
            running = true;
            spawnFood();
            intervalId = setInterval(loop, 200); // Slower: 5 FPS
        }

        // Controls (Arrow keys and WASD)
        document.addEventListener('keydown', e => {
            if (!running) return;
            if ((e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') && direction.y !== 1)
                nextDirection = {x: 0, y: -1};
            else if ((e.key === 'ArrowDown' || e.key === 's' || e.key === 'S') && direction.y !== -1)
                nextDirection = {x: 0, y: 1};
            else if ((e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') && direction.x !== 1)
                nextDirection = {x: -1, y: 0};
            else if ((e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') && direction.x !== -1)
                nextDirection = {x: 1, y: 0};
        });
    
        function stopGame() {
            running = false;
            clearInterval(intervalId);
            scoreDiv.style.display = 'none';
            bestScoreDiv.style.display = 'none';
            canvas.style.display = 'none';
            backBtn.style.display = 'none';
        }

        function spawnFood() {
            while (true) {
                let fx = Math.floor(Math.random() * gridWidth);
                let fy = Math.floor(Math.random() * gridHeight);
                if (!snake.some(s => s.x === fx && s.y === fy)) {
                    food = {x: fx, y: fy};
                    break;
                }
            }
        }

        // Controls (duplicate, can be removed if desired)
        document.addEventListener('keydown', e => {
            if (!running) return;
            if (e.key === 'ArrowUp' && direction.y !== 1) nextDirection = {x: 0, y: -1};
            else if (e.key === 'ArrowDown' && direction.y !== -1) nextDirection = {x: 0, y: 1};
            else if (e.key === 'ArrowLeft' && direction.x !== 1) nextDirection = {x: -1, y: 0};
            else if (e.key === 'ArrowRight' && direction.x !== -1) nextDirection = {x: 1, y: 0};
        });

        function drawCookie(x, y, r) {
            // Cookie base
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
            ctx.fillStyle = '#deb887';
            ctx.fill();
            // Cookie chips
            for (let i = 0; i < 6; i++) {
                let chipAngle = Math.random() * Math.PI * 2;
                let chipR = r * 0.6 * Math.random();
                let cx = x + Math.cos(chipAngle) * chipR;
                let cy = y + Math.sin(chipAngle) * chipR;
                ctx.beginPath();
                ctx.arc(cx, cy, r * 0.13, 0, Math.PI * 2);
                ctx.fillStyle = '#6b3e26';
                ctx.fill();
            }
        }

        function drawGrid() {
            ctx.save();
            ctx.strokeStyle = "#e0cfa0";
            ctx.lineWidth = 1;
            // Vertical lines
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            // Horizontal lines
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            ctx.restore();
        }

        function update() {
            direction = nextDirection;
            // Move snake
            const newHead = {
                x: snake[0].x + direction.x,
                y: snake[0].y + direction.y
            };

            // Wall collision
            if (
                newHead.x < 0 || newHead.x >= gridWidth ||
                newHead.y < 0 || newHead.y >= gridHeight
            ) {
                handleGameOver();
                return false;
            }

            // Self-collision
            if (snake.some(s => s.x === newHead.x && s.y === newHead.y)) {
                handleGameOver();
                return false;
            }

            snake.unshift(newHead);

            // Eat food
            if (newHead.x === food.x && newHead.y === food.y) {
                score += 1;
                scoreDiv.textContent = "Score: " + score;
                if (score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('slithercookie_best', bestScore);
                    bestScoreDiv.textContent = "Your best score is: " + bestScore;
                }
                spawnFood();
            } else {
                snake.pop();
            }
            return true;
        }

        function handleGameOver() {
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('slithercookie_best', bestScore);
            }
            alert('Game Over! Final Score: ' + score + '\nYour best score is: ' + bestScore);
            stopGame();
            mainMenu.style.display = 'flex';
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            drawGrid();

            // Draw food
            drawCookie(food.x * gridSize + gridSize/2, food.y * gridSize + gridSize/2, gridSize/2 - 2);

            // Draw snake
            for (let i = snake.length - 1; i >= 0; i--) {
                drawCookie(snake[i].x * gridSize + gridSize/2, snake[i].y * gridSize + gridSize/2, gridSize/2 - 2);
            }

            // Draw player name above head
            ctx.font = "bold 20px sans-serif";
            ctx.textAlign = "center";
            ctx.fillStyle = "#8b5c2a";
            ctx.strokeStyle = "#fffbe6";
            ctx.lineWidth = 4;
            ctx.strokeText(playerName, snake[0].x * gridSize + gridSize/2, snake[0].y * gridSize - 8);
            ctx.fillText(playerName, snake[0].x * gridSize + gridSize/2, snake[0].y * gridSize - 8);
        }

        function loop() {
            if (!running) return;
            if (!update()) return;
            draw();
        }
    </script>
</body>
</html>
